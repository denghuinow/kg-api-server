# kg-api-server 配置模板（YAML）
server:
  host: "0.0.0.0"
  port: 8021
  cors_allow_origins: ["*"]
  # API Key 验证（必填）
  # 所有接口都需要在请求头中提供 Authorization: Bearer <token>
  # 二选一：api_key 或 api_key_env
  api_key: "your-api-key-here"
  # api_key_env: API_KEY  # 可选：从环境变量读取

neo4j:
  uri: "neo4j://127.0.0.1:7687"
  username: "neo4j"
  # password_env: NEO4J_PASSWORD
  password: "password"
  database: "neo4j"

retention:
  max_versions: 10
  enable_cleanup: true

query:
  default_limit_nodes: 500
  default_limit_edges: 1000
  default_depth: 2
  max_depth: 5
  max_seed_nodes: 30

hooks:
  module: "server.utils.hooks_example"
  full: "get_full_data"
  incremental: "get_incremental_data"

llm:
  # 二选一：api_key 或 api_key_env
  api_key_env: LLM_API_KEY
  api_base_url: "http://127.0.0.1:8000/v1"
  model: "gpt-4o-mini"
  max_tokens: 4096
  temperature: 0
  max_retries: 0
  rate_limit:
    rpm: 120
    tpm: 200000
  concurrency:
    max_in_flight: 8
  retry:
    max_retries: 6
    initial_backoff_s: 1.0
    max_backoff_s: 30.0
    backoff_multiplier: 2.0

embeddings:
  api_key_env: EMBEDDINGS_API_KEY
  api_base_url: "http://127.0.0.1:8000/v1"
  model: "text-embedding-3-small"
  rate_limit:
    rpm: 300
    tpm: 600000
  concurrency:
    max_in_flight: 16
  retry:
    max_retries: 6
    initial_backoff_s: 1.0
    max_backoff_s: 30.0
    backoff_multiplier: 2.0

task:
  timeout_s: 0

logging:
  level: "INFO"
  silence_http_requests: true

deps:
  # 可选：本地联调时优先使用仓库内 itext2kg（避免误用 site-packages 旧版本）
  local_itext2kg_path: "../itext2kg"

output:
  language: zh
  # source: 实体名尽量保持原文；normalized: 允许轻度规范化
  entity_name_mode: source
  # source: 关系名尽量来自原文表达（中文动词/动宾短语）；en_snake: 英文 snake_case
  relation_name_mode: source
  # 当模型未给出关系名或给出空白时的兜底关系名
  relation_fallback_name: related_to

ontology:
  auto_entity_label:
    enabled: true
    allow_new_labels: true
    unknown_label: unknown
    drop_unknown: false
    hints:
      - 团队
    max_facts_per_entity: 6
    batch_size: 80

atom:
  ent_threshold: 0.9
  rel_threshold: 0.9
  entity_name_weight: 0.8
  entity_label_weight: 0.2
  max_workers: 8
  debug:
    log_empty_relation_name: false
    relation_name_sample_size: 5
  matching:
    require_same_entity_label: true
    rename_relationship_by_embedding: false
